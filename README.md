# README: Антикризисное реагирование на баги в продакшене

## Оглавление

1. [Введение](#введение)
2. [Общие принципы](#общие-принципы)
3. [Классификация инцидентов](#классификация-инцидентов)
4. [Порядок действий](#порядок-действий)
5. [Hotfix-процесс](#hotfix-процесс)
6. [Откат (Rollback)](#откат-rollback)
7. [Режим технических работ (Maintenance Mode)](#режим-технических-работ-maintenance-mode)
8. [Рекомендации по миграциям БД](#рекомендации-по-миграциям-бд)
9. [Чеклист реагирования](#чеклист-реагирования)
10. [Реальные кейсы и рекомендации](#реальные-кейсы-и-рекомендации)

---

## Введение

Данный документ описывает стандартные сценарии реагирования на баги в продакшене, методы устранения критических ошибок и порядок действий при невозможности быстрого отката или фикса.

---

## Общие принципы

* Все действия должны быть **максимально прозрачными** и понятными для всех участников процесса.
* Необходимо стремиться к **минимизации ущерба для пользователей и данных**.
* Решения принимаются исходя из **анализа критичности багов** и возможностей инфраструктуры.

---

## Классификация инцидентов

1. **Некритичный баг**
   Не влияет критически на бизнес-логику, не приводит к потере данных/денег.
   *Пример*: некорректный текст, неверная иконка, малозаметный UI-баг.

2. **Критичный баг, возможен откат**
   Существует риск для пользователей/бизнеса (потеря данных, денег), но возможен быстрый возврат к рабочей версии.

3. **Критичный баг, откат невозможен**
   Баг угрожает пользователям/бизнесу, но возврат к рабочей версии невозможен (например, необратимые миграции БД).

---

## Порядок действий

### 1. Анализ инцидента

* Собрать информацию о баге, оценить его влияние и срочность.

### 2. Выбор стратегии реагирования

* **Hotfix** — если баг можно оперативно устранить, и ущерб минимален.
* **Rollback** — если баг критичен, возможен быстрый откат до рабочей версии.
* **Maintenance Mode** — если баг критичен, но невозможно быстро откатить/починить.

### 3. Оповещение пользователей и команды

* Информировать команду, руководство, пользователей (если нужно) о проблеме и выбранной стратегии.

### 4. Реализация решения

* В зависимости от выбранной стратегии — разработка hotfix, откат через DevOps, перевод сервиса в maintenance mode.

### 5. Восстановление работоспособности

* Проверить, что баг устранён, сервис восстановлен, данные целы.

### 6. Post-mortem

* Провести разбор инцидента, определить причины, выработать меры по недопущению повторения.

---

## Hotfix-процесс

1. **Создание hotfix-ветки** от актуального продакшн-релиза (например, от тега `v1.0.2`).
2. **Внесение минимальных изменений** — только исправление бага.
3. **Тестирование hotfix** (авто- и ручное).
4. **Деплой фиксированной версии** в продакшн.
5. **Слияние hotfix-ветки в develop и master/main**.
6. **Документирование изменений** (release notes, changelog).

---

## Откат (Rollback)

1. **Оценить возможность отката**

   * Проверить, были ли несовместимые миграции БД, возможно ли “откатить” схему и данные.
2. **Откат приложения**

   * С помощью CI/CD-деплоя развернуть предыдущий рабочий тег/релиз.
3. **Откат миграций БД**

   * Использовать down-скрипты, если они предусмотрены, либо восстановить из бэкапа.
4. **Проверить работоспособность**

   * Обязательно провести тесты после отката.
5. **Коммуникация**

   * Сообщить команде и пользователям о завершении отката и восстановлении работы.

---

## Режим технических работ (Maintenance Mode)

1. **Перевести сервис (или его части) в maintenance mode**

   * Блокировать новые операции пользователей (записи, изменения), оставить только безопасное чтение или полностью закрыть доступ.
2. **Отображать понятное сообщение**

   * Например:

     > “Сервис временно недоступен. Ведутся технические работы. Приносим извинения за неудобства. Повторите попытку позже.”
3. **Параллельно устранять проблему**

   * Разработка hotfix, ручное восстановление данных, анализ инцидента.
4. **Восстановить доступ**

   * После устранения багов сервис возвращается в рабочий режим, пользователей информируют о завершении работ.

---

## Рекомендации по миграциям БД

* Всегда делать **бэкап БД** перед релизами с миграциями.
* Все миграции должны быть **тестированы на стенде**.
* Стремиться к **безопасным, обратимым миграциям**.
* Критические (destructive) миграции — только с ручным подтверждением.
* Для rollback миграций писать down-скрипты и тестировать их заранее.

---

## Чеклист реагирования

* [ ] Получен сигнал о баге/инциденте.
* [ ] Оценена критичность (бизнес- и пользовательские риски).
* [ ] Выбрана стратегия (hotfix / rollback / maintenance mode).
* [ ] Проинформирована команда и, при необходимости, пользователи.
* [ ] Приняты меры (hotfix/откат/техработы).
* [ ] Восстановлена работоспособность.
* [ ] Проведён post-mortem, составлен план улучшений.

---

## Реальные кейсы и рекомендации

* **Ошибка в миграции БД (destructive)**
  — Был сделан бэкап, ошибка замечена через 10 минут после релиза, сервис переведён в maintenance, БД восстановлена из бэкапа, hotfix разработан и выкачен за 1 час.

* **Hotfix после обнаружения багованной функции**
  — Выявлен баг в некритичной функции, разработан и выкачен hotfix, пользователи не заметили простоя.

* **Критичный баг без возможности отката**
  — Перевод в maintenance mode, информирование пользователей, экстренный hotfix, затем разбор ситуации и пересмотр практик миграций.

---

## Заключение

Чёткое следование данным сценариям позволяет команде быстро реагировать на любые инциденты, минимизировать риски и поддерживать доверие пользователей.

---

Если нужны шаблоны для уведомлений пользователей, примеры maintenance-страниц или подробные схемы процессов — напишите, и я добавлю!
